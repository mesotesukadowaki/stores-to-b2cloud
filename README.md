# Stores to b2Cloud

STORESのオーダーcsvを、ヤマト運輸の B2Cloud の送り状レイアウトcsvに変換します。データカスタマイズ後、Webサーバへの設置が必要です。
なお全ての処理はブラウザ側で行われるので、ローカルPCのWebサーバでも問題なく動作します。

## 特徴

オーダーcsvからB2クラウドのレイアウト変更は、B2クラウドの紐付け機能でもできますが、このプログラムでは以下のことができます。

* 「依頼主」を原則として事業者に設定できる。STORES「ギフト」で購入されたものは、購入者が依頼主に設定される。
* 読み込み時に、STORESのオーダーで「備考」があった場合は、メッセージとして表示する。

## 問題点

STORESの住所情報は、B2クラウドの情報ほど細かく分かれていません。このため、「アパート・マンション名」が正しく抽出できません。
カタカナが2文字以上続く場所から後を「アパート・マンション名」とみなして分割しますが、カタカナではないアパート名などでは問題が発生します。

B2クラウドで読み込み後に修正してください。

## 設定

`default-data.json`を用意します。`dafault-data-template.json`をもとにしてください。

``` json
{
  "senderZip" : "1000001",
  "senderAddress" : "東京都千代田区千代田1-1-1",
  "senderAddress2" : "山田荘101",
  "senderTel" : "090-1111-1111",
  "senderName" : "山田たろう",
  "customerId" : "1234567890",
  "contentsName" : "計算機",
  "customerKind" : "",
  "fareId" : "01",
  "cool" : 0,
  "sendKind" : 0
}
```

* `sender`で始まる要素は、デフォルトの依頼人です。
* `contentsName`は品名にはいります。（STORESの品名は、今は反映させていません）
* `customerId`は、B2クラウドの顧客コードです。
* `customerKind`は、B2クラウドの請求先分類コードです。
* `fareId`は、B2クラウドの運賃管理番号です。

## 設置

Webサーバ上の適切な場所に、`index.html`、`build/index.js`、`default-data.config`を設置してください。
rsyncを使う場合は、`deploy-template.sh`も参考になるでしょう。

## 使い方

ページを開き、「入力ファイル」に、STORESからダウンロードしたオーダーcsvを指定します。その他の設定を必要に応じて変更した上で、下の「変更」を押してください。
その下に、「B2クラウド用csvダウンロード」のリンクが現れます。STORESオーダーで備考に書かれていることがあれば、その下の領域に表示されます。

ダウンロードしたcsvを、「送り状発行システムB2クラウド」の「外部データから発行」で、「基本レイアウト(csv)」を選択した上で、アップロードしてください。
「取り込み開始行」は2行目です。



